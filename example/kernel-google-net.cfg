preset: "rocky8"
package: "BaseOS//kernel"

upstream {
  git: "https://kernel.googlesource.com/pub/scm/linux/kernel/git/torvalds/linux"
  depth: 1
  tag: "v5.17-rc7"
}

changes {
  recursive_path: "drivers/net/ethernet/google"

  file_change {
    path: "drivers/net/ethernet/google/gve/gve_ethtool.c"

    search_replace {
      find: "struct kernel_ethtool_coalesce *kernel_ec,"
      replace: ""
    }
    search_replace {
      find: "struct netlink_ext_ack *extack"
      replace: ""
    }
    search_replace {
      find: "struct kernel_ethtool_ringparam *kernel_cmd,"
      replace: ""
    }
    search_replace {
      find: "struct ethtool_coalesce *ec,"
      replace: "struct ethtool_coalesce *ec"
    }
    search_replace {
      find: "struct ethtool_ringparam *cmd,"
      replace: "struct ethtool_ringparam *cmd"
    }
  }

  file_change {
    path: "drivers/net/ethernet/google/gve/gve_adminq.c"

    search_replace {
      find: "eth_hw_addr_set(priv->dev"
      replace: "ether_addr_copy(priv->dev->dev_addr"
    }
  }
}
